var f={};Object.defineProperty(f,"__esModule",{value:!0});f.retryAsPromised=f.TimeoutError=void 0;class d extends Error{constructor(r,e){super(r),this.name="TimeoutError",this.previous=e}}f.TimeoutError=d;function T(t,r){if(typeof t=="function")try{if(r instanceof t)return!0}catch{return!!t(r)}return t===r.toString()||t===r.message?!0:t instanceof RegExp&&(t.test(r.message)||t.test(r.toString()))}function m(t,r){if(!t||!r)throw new Error("retry-as-promised must be passed a callback and a options set");r=typeof r=="number"?{max:r}:r;const e={$current:"$current"in r?r.$current:1,max:r.max,timeout:r.timeout||void 0,match:r.match?Array.isArray(r.match)?r.match:[r.match]:[],backoffBase:r.backoffBase===void 0?100:r.backoffBase,backoffExponent:r.backoffExponent||1.1,report:r.report,name:r.name||t.name||"unknown"};return e.match&&!Array.isArray(e.match)&&(e.match=[e.match]),e.report&&e.report("Trying "+e.name+" #"+e.$current+" at "+new Date().toLocaleTimeString(),e),new Promise(function(u,n){let o,i,y;e.timeout&&(o=setTimeout(function(){i&&clearTimeout(i),n(new d(e.name+" timed out",y))},e.timeout)),Promise.resolve(t({current:e.$current})).then(u).then(function(){o&&clearTimeout(o),i&&clearTimeout(i)}).catch(function(a){o&&clearTimeout(o),i&&clearTimeout(i),y=a,e.report&&e.report(a&&a.toString()||a,e,a);var c=e.$current<e.max;if(!c||(c=e.match.length===0||e.match.some(function(h){return T(h,a)}),!c))return n(a);var s=e.backoffBase*Math.pow(e.backoffExponent,e.$current-1);e.$current++,e.report&&e.report(`Retrying ${e.name} (${e.$current})`,e),s?(e.report&&e.report(`Delaying retry of ${e.name} by ${s}`,e),i=setTimeout(function(){m(t,e).then(u).catch(n)},s)):m(t,e).then(u).catch(n)})})}f.retryAsPromised=m;f.default=m;export{f as d};
