import{r as x}from"./pg-connection-string-CVG-28Ap.js";var _={},v={wkt:{Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION"},wkb:{Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6,GeometryCollection:7},geoJSON:{Point:"Point",LineString:"LineString",Polygon:"Polygon",MultiPoint:"MultiPoint",MultiLineString:"MultiLineString",MultiPolygon:"MultiPolygon",GeometryCollection:"GeometryCollection"}},Z=b;function b(h,g){this.buffer=new Buffer(h),this.position=0,this.allowResize=g}function S(h,g){return function(f,p){this.ensureSize(g),h.call(this.buffer,f,this.position,p),this.position+=g}}b.prototype.writeUInt8=S(Buffer.prototype.writeUInt8,1);b.prototype.writeUInt16LE=S(Buffer.prototype.writeUInt16LE,2);b.prototype.writeUInt16BE=S(Buffer.prototype.writeUInt16BE,2);b.prototype.writeUInt32LE=S(Buffer.prototype.writeUInt32LE,4);b.prototype.writeUInt32BE=S(Buffer.prototype.writeUInt32BE,4);b.prototype.writeInt8=S(Buffer.prototype.writeInt8,1);b.prototype.writeInt16LE=S(Buffer.prototype.writeInt16LE,2);b.prototype.writeInt16BE=S(Buffer.prototype.writeInt16BE,2);b.prototype.writeInt32LE=S(Buffer.prototype.writeInt32LE,4);b.prototype.writeInt32BE=S(Buffer.prototype.writeInt32BE,4);b.prototype.writeFloatLE=S(Buffer.prototype.writeFloatLE,4);b.prototype.writeFloatBE=S(Buffer.prototype.writeFloatBE,4);b.prototype.writeDoubleLE=S(Buffer.prototype.writeDoubleLE,8);b.prototype.writeDoubleBE=S(Buffer.prototype.writeDoubleBE,8);b.prototype.writeBuffer=function(h){this.ensureSize(h.length),h.copy(this.buffer,this.position,0,h.length),this.position+=h.length};b.prototype.writeVarInt=function(h){for(var g=1;h&4294967168;)this.writeUInt8(h&127|128),h>>>=7,g++;return this.writeUInt8(h&127),g};b.prototype.ensureSize=function(h){if(this.buffer.length<this.position+h)if(this.allowResize){var g=new Buffer(this.position+h);this.buffer.copy(g,0,0,this.buffer.length),this.buffer=g}else throw new RangeError("index out of range")};var X={encode:function(h){return h<<1^h>>31},decode:function(h){return h>>1^-(h&1)}},T,V;function P(){if(V)return T;V=1,T=i;var h=x,g=W(),f=v,p=Z,o=X;function i(r,t,e,n,u){g.call(this),this.x=r,this.y=t,this.z=e,this.m=n,this.srid=u,this.hasZ=typeof this.z<"u",this.hasM=typeof this.m<"u"}return h.inherits(i,g),i.Z=function(r,t,e,n){var u=new i(r,t,e,void 0,n);return u.hasZ=!0,u},i.M=function(r,t,e,n){var u=new i(r,t,void 0,e,n);return u.hasM=!0,u},i.ZM=function(r,t,e,n,u){var l=new i(r,t,e,n,u);return l.hasZ=!0,l.hasM=!0,l},i._parseWkt=function(r,t){var e=new i;if(e.srid=t.srid,e.hasZ=t.hasZ,e.hasM=t.hasM,r.isMatch(["EMPTY"]))return e;r.expectGroupStart();var n=r.matchCoordinate(t);return e.x=n.x,e.y=n.y,e.z=n.z,e.m=n.m,r.expectGroupEnd(),e},i._parseWkb=function(r,t){var e=i._readWkbPoint(r,t);return e.srid=t.srid,e},i._readWkbPoint=function(r,t){return new i(r.readDouble(),r.readDouble(),t.hasZ?r.readDouble():void 0,t.hasM?r.readDouble():void 0)},i._parseTwkb=function(r,t){var e=new i;return e.hasZ=t.hasZ,e.hasM=t.hasM,t.isEmpty||(e.x=o.decode(r.readVarInt())/t.precisionFactor,e.y=o.decode(r.readVarInt())/t.precisionFactor,e.z=t.hasZ?o.decode(r.readVarInt())/t.zPrecisionFactor:void 0,e.m=t.hasM?o.decode(r.readVarInt())/t.mPrecisionFactor:void 0),e},i._readTwkbPoint=function(r,t,e){return e.x+=o.decode(r.readVarInt())/t.precisionFactor,e.y+=o.decode(r.readVarInt())/t.precisionFactor,t.hasZ&&(e.z+=o.decode(r.readVarInt())/t.zPrecisionFactor),t.hasM&&(e.m+=o.decode(r.readVarInt())/t.mPrecisionFactor),new i(e.x,e.y,e.z,e.m)},i._parseGeoJSON=function(r){return i._readGeoJSONPoint(r.coordinates)},i._readGeoJSONPoint=function(r){return r.length===0?new i:r.length>2?new i(r[0],r[1],r[2]):new i(r[0],r[1])},i.prototype.toWkt=function(){return typeof this.x>"u"&&typeof this.y>"u"&&typeof this.z>"u"&&typeof this.m>"u"?this._getWktType(f.wkt.Point,!0):this._getWktType(f.wkt.Point,!1)+"("+this._getWktCoordinate(this)+")"},i.prototype.toWkb=function(r){var t=new p(this._getWkbSize());return t.writeInt8(1),this._writeWkbType(t,f.wkb.Point,r),typeof this.x>"u"&&typeof this.y>"u"?(t.writeDoubleLE(NaN),t.writeDoubleLE(NaN),this.hasZ&&t.writeDoubleLE(NaN),this.hasM&&t.writeDoubleLE(NaN)):this._writeWkbPoint(t),t.buffer},i.prototype._writeWkbPoint=function(r){r.writeDoubleLE(this.x),r.writeDoubleLE(this.y),this.hasZ&&r.writeDoubleLE(this.z),this.hasM&&r.writeDoubleLE(this.m)},i.prototype.toTwkb=function(){var r=new p(0,!0),t=g.getTwkbPrecision(5,0,0),e=typeof this.x>"u"&&typeof this.y>"u";return this._writeTwkbHeader(r,f.wkb.Point,t,e),e||this._writeTwkbPoint(r,t,new i(0,0,0,0)),r.buffer},i.prototype._writeTwkbPoint=function(r,t,e){var n=this.x*t.xyFactor,u=this.y*t.xyFactor,l=this.z*t.zFactor,y=this.m*t.mFactor;r.writeVarInt(o.encode(n-e.x)),r.writeVarInt(o.encode(u-e.y)),this.hasZ&&r.writeVarInt(o.encode(l-e.z)),this.hasM&&r.writeVarInt(o.encode(y-e.m)),e.x=n,e.y=u,e.z=l,e.m=y},i.prototype._getWkbSize=function(){var r=21;return this.hasZ&&(r+=8),this.hasM&&(r+=8),r},i.prototype.toGeoJSON=function(r){var t=g.prototype.toGeoJSON.call(this,r);return t.type=f.geoJSON.Point,typeof this.x>"u"&&typeof this.y>"u"?t.coordinates=[]:typeof this.z<"u"?t.coordinates=[this.x,this.y,this.z]:t.coordinates=[this.x,this.y],t},T}var G,D;function C(){if(D)return G;D=1,G=i;var h=x,g=W(),f=v,p=P(),o=Z;function i(r,t){g.call(this),this.points=r||[],this.srid=t,this.points.length>0&&(this.hasZ=this.points[0].hasZ,this.hasM=this.points[0].hasM)}return h.inherits(i,g),i.Z=function(r,t){var e=new i(r,t);return e.hasZ=!0,e},i.M=function(r,t){var e=new i(r,t);return e.hasM=!0,e},i.ZM=function(r,t){var e=new i(r,t);return e.hasZ=!0,e.hasM=!0,e},i._parseWkt=function(r,t){var e=new i;return e.srid=t.srid,e.hasZ=t.hasZ,e.hasM=t.hasM,r.isMatch(["EMPTY"])||(r.expectGroupStart(),e.points.push.apply(e.points,r.matchCoordinates(t)),r.expectGroupEnd()),e},i._parseWkb=function(r,t){var e=new i;e.srid=t.srid,e.hasZ=t.hasZ,e.hasM=t.hasM;for(var n=r.readUInt32(),u=0;u<n;u++)e.points.push(p._readWkbPoint(r,t));return e},i._parseTwkb=function(r,t){var e=new i;if(e.hasZ=t.hasZ,e.hasM=t.hasM,t.isEmpty)return e;for(var n=new p(0,0,t.hasZ?0:void 0,t.hasM?0:void 0),u=r.readVarInt(),l=0;l<u;l++)e.points.push(p._readTwkbPoint(r,t,n));return e},i._parseGeoJSON=function(r){var t=new i;r.coordinates.length>0&&(t.hasZ=r.coordinates[0].length>2);for(var e=0;e<r.coordinates.length;e++)t.points.push(p._readGeoJSONPoint(r.coordinates[e]));return t},i.prototype.toWkt=function(){return this.points.length===0?this._getWktType(f.wkt.LineString,!0):this._getWktType(f.wkt.LineString,!1)+this._toInnerWkt()},i.prototype._toInnerWkt=function(){for(var r="(",t=0;t<this.points.length;t++)r+=this._getWktCoordinate(this.points[t])+",";return r=r.slice(0,-1),r+=")",r},i.prototype.toWkb=function(r){var t=new o(this._getWkbSize());t.writeInt8(1),this._writeWkbType(t,f.wkb.LineString,r),t.writeUInt32LE(this.points.length);for(var e=0;e<this.points.length;e++)this.points[e]._writeWkbPoint(t);return t.buffer},i.prototype.toTwkb=function(){var r=new o(0,!0),t=g.getTwkbPrecision(5,0,0),e=this.points.length===0;if(this._writeTwkbHeader(r,f.wkb.LineString,t,e),this.points.length>0){r.writeVarInt(this.points.length);for(var n=new p(0,0,0,0),u=0;u<this.points.length;u++)this.points[u]._writeTwkbPoint(r,t,n)}return r.buffer},i.prototype._getWkbSize=function(){var r=16;return this.hasZ&&(r+=8),this.hasM&&(r+=8),9+this.points.length*r},i.prototype.toGeoJSON=function(r){var t=g.prototype.toGeoJSON.call(this,r);t.type=f.geoJSON.LineString,t.coordinates=[];for(var e=0;e<this.points.length;e++)this.hasZ?t.coordinates.push([this.points[e].x,this.points[e].y,this.points[e].z]):t.coordinates.push([this.points[e].x,this.points[e].y]);return t},G}var L,q;function U(){if(q)return L;q=1,L=i;var h=x,g=W(),f=v,p=P(),o=Z;function i(r,t,e){g.call(this),this.exteriorRing=r||[],this.interiorRings=t||[],this.srid=e,this.exteriorRing.length>0&&(this.hasZ=this.exteriorRing[0].hasZ,this.hasM=this.exteriorRing[0].hasM)}return h.inherits(i,g),i.Z=function(r,t,e){var n=new i(r,t,e);return n.hasZ=!0,n},i.M=function(r,t,e){var n=new i(r,t,e);return n.hasM=!0,n},i.ZM=function(r,t,e){var n=new i(r,t,e);return n.hasZ=!0,n.hasM=!0,n},i._parseWkt=function(r,t){var e=new i;if(e.srid=t.srid,e.hasZ=t.hasZ,e.hasM=t.hasM,r.isMatch(["EMPTY"]))return e;for(r.expectGroupStart(),r.expectGroupStart(),e.exteriorRing.push.apply(e.exteriorRing,r.matchCoordinates(t)),r.expectGroupEnd();r.isMatch([","]);)r.expectGroupStart(),e.interiorRings.push(r.matchCoordinates(t)),r.expectGroupEnd();return r.expectGroupEnd(),e},i._parseWkb=function(r,t){var e=new i;e.srid=t.srid,e.hasZ=t.hasZ,e.hasM=t.hasM;var n=r.readUInt32();if(n>0){for(var u=r.readUInt32(),l=0;l<u;l++)e.exteriorRing.push(p._readWkbPoint(r,t));for(l=1;l<n;l++){for(var y=[],a=r.readUInt32(),c=0;c<a;c++)y.push(p._readWkbPoint(r,t));e.interiorRings.push(y)}}return e},i._parseTwkb=function(r,t){var e=new i;if(e.hasZ=t.hasZ,e.hasM=t.hasM,t.isEmpty)return e;for(var n=new p(0,0,t.hasZ?0:void 0,t.hasM?0:void 0),u=r.readVarInt(),l=r.readVarInt(),y=0;y<l;y++)e.exteriorRing.push(p._readTwkbPoint(r,t,n));for(y=1;y<u;y++){for(var a=[],c=r.readVarInt(),s=0;s<c;s++)a.push(p._readTwkbPoint(r,t,n));e.interiorRings.push(a)}return e},i._parseGeoJSON=function(r){var t=new i;r.coordinates.length>0&&r.coordinates[0].length>0&&(t.hasZ=r.coordinates[0][0].length>2);for(var e=0;e<r.coordinates.length;e++){e>0&&t.interiorRings.push([]);for(var n=0;n<r.coordinates[e].length;n++)e===0?t.exteriorRing.push(p._readGeoJSONPoint(r.coordinates[e][n])):t.interiorRings[e-1].push(p._readGeoJSONPoint(r.coordinates[e][n]))}return t},i.prototype.toWkt=function(){return this.exteriorRing.length===0?this._getWktType(f.wkt.Polygon,!0):this._getWktType(f.wkt.Polygon,!1)+this._toInnerWkt()},i.prototype._toInnerWkt=function(){for(var r="((",t=0;t<this.exteriorRing.length;t++)r+=this._getWktCoordinate(this.exteriorRing[t])+",";for(r=r.slice(0,-1),r+=")",t=0;t<this.interiorRings.length;t++){r+=",(";for(var e=0;e<this.interiorRings[t].length;e++)r+=this._getWktCoordinate(this.interiorRings[t][e])+",";r=r.slice(0,-1),r+=")"}return r+=")",r},i.prototype.toWkb=function(r){var t=new o(this._getWkbSize());t.writeInt8(1),this._writeWkbType(t,f.wkb.Polygon,r),this.exteriorRing.length>0?(t.writeUInt32LE(1+this.interiorRings.length),t.writeUInt32LE(this.exteriorRing.length)):t.writeUInt32LE(0);for(var e=0;e<this.exteriorRing.length;e++)this.exteriorRing[e]._writeWkbPoint(t);for(e=0;e<this.interiorRings.length;e++){t.writeUInt32LE(this.interiorRings[e].length);for(var n=0;n<this.interiorRings[e].length;n++)this.interiorRings[e][n]._writeWkbPoint(t)}return t.buffer},i.prototype.toTwkb=function(){var r=new o(0,!0),t=g.getTwkbPrecision(5,0,0),e=this.exteriorRing.length===0;if(this._writeTwkbHeader(r,f.wkb.Polygon,t,e),this.exteriorRing.length>0){r.writeVarInt(1+this.interiorRings.length),r.writeVarInt(this.exteriorRing.length);for(var n=new p(0,0,0,0),u=0;u<this.exteriorRing.length;u++)this.exteriorRing[u]._writeTwkbPoint(r,t,n);for(u=0;u<this.interiorRings.length;u++){r.writeVarInt(this.interiorRings[u].length);for(var l=0;l<this.interiorRings[u].length;l++)this.interiorRings[u][l]._writeTwkbPoint(r,t,n)}}return r.buffer},i.prototype._getWkbSize=function(){var r=16;this.hasZ&&(r+=8),this.hasM&&(r+=8);var t=9;this.exteriorRing.length>0&&(t+=4+this.exteriorRing.length*r);for(var e=0;e<this.interiorRings.length;e++)t+=4+this.interiorRings[e].length*r;return t},i.prototype.toGeoJSON=function(r){var t=g.prototype.toGeoJSON.call(this,r);if(t.type=f.geoJSON.Polygon,t.coordinates=[],this.exteriorRing.length>0){for(var e=[],n=0;n<this.exteriorRing.length;n++)this.hasZ?e.push([this.exteriorRing[n].x,this.exteriorRing[n].y,this.exteriorRing[n].z]):e.push([this.exteriorRing[n].x,this.exteriorRing[n].y]);t.coordinates.push(e)}for(var u=0;u<this.interiorRings.length;u++){for(var l=[],y=0;y<this.interiorRings[u].length;y++)this.hasZ?l.push([this.interiorRings[u][y].x,this.interiorRings[u][y].y,this.interiorRings[u][y].z]):l.push([this.interiorRings[u][y].x,this.interiorRings[u][y].y]);t.coordinates.push(l)}return t},L}var R,Y;function j(){if(Y)return R;Y=1,R=i;var h=x,g=v,f=W(),p=P(),o=Z;function i(r,t){f.call(this),this.points=r||[],this.srid=t,this.points.length>0&&(this.hasZ=this.points[0].hasZ,this.hasM=this.points[0].hasM)}return h.inherits(i,f),i.Z=function(r,t){var e=new i(r,t);return e.hasZ=!0,e},i.M=function(r,t){var e=new i(r,t);return e.hasM=!0,e},i.ZM=function(r,t){var e=new i(r,t);return e.hasZ=!0,e.hasM=!0,e},i._parseWkt=function(r,t){var e=new i;return e.srid=t.srid,e.hasZ=t.hasZ,e.hasM=t.hasM,r.isMatch(["EMPTY"])||(r.expectGroupStart(),e.points.push.apply(e.points,r.matchCoordinates(t)),r.expectGroupEnd()),e},i._parseWkb=function(r,t){var e=new i;e.srid=t.srid,e.hasZ=t.hasZ,e.hasM=t.hasM;for(var n=r.readUInt32(),u=0;u<n;u++)e.points.push(f.parse(r,t));return e},i._parseTwkb=function(r,t){var e=new i;if(e.hasZ=t.hasZ,e.hasM=t.hasM,t.isEmpty)return e;for(var n=new p(0,0,t.hasZ?0:void 0,t.hasM?0:void 0),u=r.readVarInt(),l=0;l<u;l++)e.points.push(p._readTwkbPoint(r,t,n));return e},i._parseGeoJSON=function(r){var t=new i;r.coordinates.length>0&&(t.hasZ=r.coordinates[0].length>2);for(var e=0;e<r.coordinates.length;e++)t.points.push(p._parseGeoJSON({coordinates:r.coordinates[e]}));return t},i.prototype.toWkt=function(){if(this.points.length===0)return this._getWktType(g.wkt.MultiPoint,!0);for(var r=this._getWktType(g.wkt.MultiPoint,!1)+"(",t=0;t<this.points.length;t++)r+=this._getWktCoordinate(this.points[t])+",";return r=r.slice(0,-1),r+=")",r},i.prototype.toWkb=function(){var r=new o(this._getWkbSize());r.writeInt8(1),this._writeWkbType(r,g.wkb.MultiPoint),r.writeUInt32LE(this.points.length);for(var t=0;t<this.points.length;t++)r.writeBuffer(this.points[t].toWkb({srid:this.srid}));return r.buffer},i.prototype.toTwkb=function(){var r=new o(0,!0),t=f.getTwkbPrecision(5,0,0),e=this.points.length===0;if(this._writeTwkbHeader(r,g.wkb.MultiPoint,t,e),this.points.length>0){r.writeVarInt(this.points.length);for(var n=new p(0,0,0,0),u=0;u<this.points.length;u++)this.points[u]._writeTwkbPoint(r,t,n)}return r.buffer},i.prototype._getWkbSize=function(){var r=16;return this.hasZ&&(r+=8),this.hasM&&(r+=8),r+=5,9+this.points.length*r},i.prototype.toGeoJSON=function(r){var t=f.prototype.toGeoJSON.call(this,r);t.type=g.geoJSON.MultiPoint,t.coordinates=[];for(var e=0;e<this.points.length;e++)t.coordinates.push(this.points[e].toGeoJSON().coordinates);return t},R}var N,H;function tt(){if(H)return N;H=1,N=r;var h=x,g=v,f=W(),p=P(),o=C(),i=Z;function r(t,e){f.call(this),this.lineStrings=t||[],this.srid=e,this.lineStrings.length>0&&(this.hasZ=this.lineStrings[0].hasZ,this.hasM=this.lineStrings[0].hasM)}return h.inherits(r,f),r.Z=function(t,e){var n=new r(t,e);return n.hasZ=!0,n},r.M=function(t,e){var n=new r(t,e);return n.hasM=!0,n},r.ZM=function(t,e){var n=new r(t,e);return n.hasZ=!0,n.hasM=!0,n},r._parseWkt=function(t,e){var n=new r;if(n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM,t.isMatch(["EMPTY"]))return n;t.expectGroupStart();do t.expectGroupStart(),n.lineStrings.push(new o(t.matchCoordinates(e))),t.expectGroupEnd();while(t.isMatch([","]));return t.expectGroupEnd(),n},r._parseWkb=function(t,e){var n=new r;n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM;for(var u=t.readUInt32(),l=0;l<u;l++)n.lineStrings.push(f.parse(t,e));return n},r._parseTwkb=function(t,e){var n=new r;if(n.hasZ=e.hasZ,n.hasM=e.hasM,e.isEmpty)return n;for(var u=new p(0,0,e.hasZ?0:void 0,e.hasM?0:void 0),l=t.readVarInt(),y=0;y<l;y++){var a=new o;a.hasZ=e.hasZ,a.hasM=e.hasM;for(var c=t.readVarInt(),s=0;s<c;s++)a.points.push(p._readTwkbPoint(t,e,u));n.lineStrings.push(a)}return n},r._parseGeoJSON=function(t){var e=new r;t.coordinates.length>0&&t.coordinates[0].length>0&&(e.hasZ=t.coordinates[0][0].length>2);for(var n=0;n<t.coordinates.length;n++)e.lineStrings.push(o._parseGeoJSON({coordinates:t.coordinates[n]}));return e},r.prototype.toWkt=function(){if(this.lineStrings.length===0)return this._getWktType(g.wkt.MultiLineString,!0);for(var t=this._getWktType(g.wkt.MultiLineString,!1)+"(",e=0;e<this.lineStrings.length;e++)t+=this.lineStrings[e]._toInnerWkt()+",";return t=t.slice(0,-1),t+=")",t},r.prototype.toWkb=function(){var t=new i(this._getWkbSize());t.writeInt8(1),this._writeWkbType(t,g.wkb.MultiLineString),t.writeUInt32LE(this.lineStrings.length);for(var e=0;e<this.lineStrings.length;e++)t.writeBuffer(this.lineStrings[e].toWkb({srid:this.srid}));return t.buffer},r.prototype.toTwkb=function(){var t=new i(0,!0),e=f.getTwkbPrecision(5,0,0),n=this.lineStrings.length===0;if(this._writeTwkbHeader(t,g.wkb.MultiLineString,e,n),this.lineStrings.length>0){t.writeVarInt(this.lineStrings.length);for(var u=new p(0,0,0,0),l=0;l<this.lineStrings.length;l++){t.writeVarInt(this.lineStrings[l].points.length);for(var y=0;y<this.lineStrings[l].points.length;y++)this.lineStrings[l].points[y]._writeTwkbPoint(t,e,u)}}return t.buffer},r.prototype._getWkbSize=function(){for(var t=9,e=0;e<this.lineStrings.length;e++)t+=this.lineStrings[e]._getWkbSize();return t},r.prototype.toGeoJSON=function(t){var e=f.prototype.toGeoJSON.call(this,t);e.type=g.geoJSON.MultiLineString,e.coordinates=[];for(var n=0;n<this.lineStrings.length;n++)e.coordinates.push(this.lineStrings[n].toGeoJSON().coordinates);return e},N}var O,A;function et(){if(A)return O;A=1,O=r;var h=x,g=v,f=W(),p=P(),o=U(),i=Z;function r(t,e){f.call(this),this.polygons=t||[],this.srid=e,this.polygons.length>0&&(this.hasZ=this.polygons[0].hasZ,this.hasM=this.polygons[0].hasM)}return h.inherits(r,f),r.Z=function(t,e){var n=new r(t,e);return n.hasZ=!0,n},r.M=function(t,e){var n=new r(t,e);return n.hasM=!0,n},r.ZM=function(t,e){var n=new r(t,e);return n.hasZ=!0,n.hasM=!0,n},r._parseWkt=function(t,e){var n=new r;if(n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM,t.isMatch(["EMPTY"]))return n;t.expectGroupStart();do{t.expectGroupStart();var u=[],l=[];for(t.expectGroupStart(),u.push.apply(u,t.matchCoordinates(e)),t.expectGroupEnd();t.isMatch([","]);)t.expectGroupStart(),l.push(t.matchCoordinates(e)),t.expectGroupEnd();n.polygons.push(new o(u,l)),t.expectGroupEnd()}while(t.isMatch([","]));return t.expectGroupEnd(),n},r._parseWkb=function(t,e){var n=new r;n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM;for(var u=t.readUInt32(),l=0;l<u;l++)n.polygons.push(f.parse(t,e));return n},r._parseTwkb=function(t,e){var n=new r;if(n.hasZ=e.hasZ,n.hasM=e.hasM,e.isEmpty)return n;for(var u=new p(0,0,e.hasZ?0:void 0,e.hasM?0:void 0),l=t.readVarInt(),y=0;y<l;y++){var a=new o;a.hasZ=e.hasZ,a.hasM=e.hasM;for(var c=t.readVarInt(),s=t.readVarInt(),w=0;w<s;w++)a.exteriorRing.push(p._readTwkbPoint(t,e,u));for(w=1;w<c;w++){for(var k=[],d=t.readVarInt(),M=0;M<d;M++)k.push(p._readTwkbPoint(t,e,u));a.interiorRings.push(k)}n.polygons.push(a)}return n},r._parseGeoJSON=function(t){var e=new r;t.coordinates.length>0&&t.coordinates[0].length>0&&t.coordinates[0][0].length>0&&(e.hasZ=t.coordinates[0][0][0].length>2);for(var n=0;n<t.coordinates.length;n++)e.polygons.push(o._parseGeoJSON({coordinates:t.coordinates[n]}));return e},r.prototype.toWkt=function(){if(this.polygons.length===0)return this._getWktType(g.wkt.MultiPolygon,!0);for(var t=this._getWktType(g.wkt.MultiPolygon,!1)+"(",e=0;e<this.polygons.length;e++)t+=this.polygons[e]._toInnerWkt()+",";return t=t.slice(0,-1),t+=")",t},r.prototype.toWkb=function(){var t=new i(this._getWkbSize());t.writeInt8(1),this._writeWkbType(t,g.wkb.MultiPolygon),t.writeUInt32LE(this.polygons.length);for(var e=0;e<this.polygons.length;e++)t.writeBuffer(this.polygons[e].toWkb({srid:this.srid}));return t.buffer},r.prototype.toTwkb=function(){var t=new i(0,!0),e=f.getTwkbPrecision(5,0,0),n=this.polygons.length===0;if(this._writeTwkbHeader(t,g.wkb.MultiPolygon,e,n),this.polygons.length>0){t.writeVarInt(this.polygons.length);for(var u=new p(0,0,0,0),l=0;l<this.polygons.length;l++){t.writeVarInt(1+this.polygons[l].interiorRings.length),t.writeVarInt(this.polygons[l].exteriorRing.length);for(var y=0;y<this.polygons[l].exteriorRing.length;y++)this.polygons[l].exteriorRing[y]._writeTwkbPoint(t,e,u);for(y=0;y<this.polygons[l].interiorRings.length;y++){t.writeVarInt(this.polygons[l].interiorRings[y].length);for(var a=0;a<this.polygons[l].interiorRings[y].length;a++)this.polygons[l].interiorRings[y][a]._writeTwkbPoint(t,e,u)}}}return t.buffer},r.prototype._getWkbSize=function(){for(var t=9,e=0;e<this.polygons.length;e++)t+=this.polygons[e]._getWkbSize();return t},r.prototype.toGeoJSON=function(t){var e=f.prototype.toGeoJSON.call(this,t);e.type=g.geoJSON.MultiPolygon,e.coordinates=[];for(var n=0;n<this.polygons.length;n++)e.coordinates.push(this.polygons[n].toGeoJSON().coordinates);return e},O}var B,$;function rt(){if($)return B;$=1,B=o;var h=x,g=v,f=W(),p=Z;function o(i,r){f.call(this),this.geometries=i||[],this.srid=r,this.geometries.length>0&&(this.hasZ=this.geometries[0].hasZ,this.hasM=this.geometries[0].hasM)}return h.inherits(o,f),o.Z=function(i,r){var t=new o(i,r);return t.hasZ=!0,t},o.M=function(i,r){var t=new o(i,r);return t.hasM=!0,t},o.ZM=function(i,r){var t=new o(i,r);return t.hasZ=!0,t.hasM=!0,t},o._parseWkt=function(i,r){var t=new o;if(t.srid=r.srid,t.hasZ=r.hasZ,t.hasM=r.hasM,i.isMatch(["EMPTY"]))return t;i.expectGroupStart();do t.geometries.push(f.parse(i));while(i.isMatch([","]));return i.expectGroupEnd(),t},o._parseWkb=function(i,r){var t=new o;t.srid=r.srid,t.hasZ=r.hasZ,t.hasM=r.hasM;for(var e=i.readUInt32(),n=0;n<e;n++)t.geometries.push(f.parse(i,r));return t},o._parseTwkb=function(i,r){var t=new o;if(t.hasZ=r.hasZ,t.hasM=r.hasM,r.isEmpty)return t;for(var e=i.readVarInt(),n=0;n<e;n++)t.geometries.push(f.parseTwkb(i));return t},o._parseGeoJSON=function(i){for(var r=new o,t=0;t<i.geometries.length;t++)r.geometries.push(f._parseGeoJSON(i.geometries[t],!0));return r.geometries.length>0&&(r.hasZ=r.geometries[0].hasZ),r},o.prototype.toWkt=function(){if(this.geometries.length===0)return this._getWktType(g.wkt.GeometryCollection,!0);for(var i=this._getWktType(g.wkt.GeometryCollection,!1)+"(",r=0;r<this.geometries.length;r++)i+=this.geometries[r].toWkt()+",";return i=i.slice(0,-1),i+=")",i},o.prototype.toWkb=function(){var i=new p(this._getWkbSize());i.writeInt8(1),this._writeWkbType(i,g.wkb.GeometryCollection),i.writeUInt32LE(this.geometries.length);for(var r=0;r<this.geometries.length;r++)i.writeBuffer(this.geometries[r].toWkb({srid:this.srid}));return i.buffer},o.prototype.toTwkb=function(){var i=new p(0,!0),r=f.getTwkbPrecision(5,0,0),t=this.geometries.length===0;if(this._writeTwkbHeader(i,g.wkb.GeometryCollection,r,t),this.geometries.length>0){i.writeVarInt(this.geometries.length);for(var e=0;e<this.geometries.length;e++)i.writeBuffer(this.geometries[e].toTwkb())}return i.buffer},o.prototype._getWkbSize=function(){for(var i=9,r=0;r<this.geometries.length;r++)i+=this.geometries[r]._getWkbSize();return i},o.prototype.toGeoJSON=function(i){var r=f.prototype.toGeoJSON.call(this,i);r.type=g.geoJSON.GeometryCollection,r.geometries=[];for(var t=0;t<this.geometries.length;t++)r.geometries.push(this.geometries[t].toGeoJSON());return r},B}var it=m;function m(h,g){this.buffer=h,this.position=0,this.isBigEndian=g||!1}function I(h,g,f){return function(){var p;return this.isBigEndian?p=g.call(this.buffer,this.position):p=h.call(this.buffer,this.position),this.position+=f,p}}m.prototype.readUInt8=I(Buffer.prototype.readUInt8,Buffer.prototype.readUInt8,1);m.prototype.readUInt16=I(Buffer.prototype.readUInt16LE,Buffer.prototype.readUInt16BE,2);m.prototype.readUInt32=I(Buffer.prototype.readUInt32LE,Buffer.prototype.readUInt32BE,4);m.prototype.readInt8=I(Buffer.prototype.readInt8,Buffer.prototype.readInt8,1);m.prototype.readInt16=I(Buffer.prototype.readInt16LE,Buffer.prototype.readInt16BE,2);m.prototype.readInt32=I(Buffer.prototype.readInt32LE,Buffer.prototype.readInt32BE,4);m.prototype.readFloat=I(Buffer.prototype.readFloatLE,Buffer.prototype.readFloatBE,4);m.prototype.readDouble=I(Buffer.prototype.readDoubleLE,Buffer.prototype.readDoubleBE,8);m.prototype.readVarInt=function(){var h,g=0,f=0;do h=this.buffer[this.position+f],g+=(h&127)<<7*f,f++;while(h>=128);return this.position+=f,g};var J,K;function nt(){if(K)return J;K=1,J=f;var h=v,g=P();function f(p){this.value=p,this.position=0}return f.prototype.match=function(p){this.skipWhitespaces();for(var o=0;o<p.length;o++)if(this.value.substring(this.position).indexOf(p[o])===0)return this.position+=p[o].length,p[o];return null},f.prototype.matchRegex=function(p){this.skipWhitespaces();for(var o=0;o<p.length;o++){var i=this.value.substring(this.position).match(p[o]);if(i)return this.position+=i[0].length,i}return null},f.prototype.isMatch=function(p){this.skipWhitespaces();for(var o=0;o<p.length;o++)if(this.value.substring(this.position).indexOf(p[o])===0)return this.position+=p[o].length,!0;return!1},f.prototype.matchType=function(){var p=this.match([h.wkt.Point,h.wkt.LineString,h.wkt.Polygon,h.wkt.MultiPoint,h.wkt.MultiLineString,h.wkt.MultiPolygon,h.wkt.GeometryCollection]);if(!p)throw new Error("Expected geometry type");return p},f.prototype.matchDimension=function(){var p=this.match(["ZM","Z","M"]);switch(p){case"ZM":return{hasZ:!0,hasM:!0};case"Z":return{hasZ:!0,hasM:!1};case"M":return{hasZ:!1,hasM:!0};default:return{hasZ:!1,hasM:!1}}},f.prototype.expectGroupStart=function(){if(!this.isMatch(["("]))throw new Error("Expected group start")},f.prototype.expectGroupEnd=function(){if(!this.isMatch([")"]))throw new Error("Expected group end")},f.prototype.matchCoordinate=function(p){var o;if(p.hasZ&&p.hasM?o=this.matchRegex([/^(\S*)\s+(\S*)\s+(\S*)\s+([^\s,)]*)/]):p.hasZ||p.hasM?o=this.matchRegex([/^(\S*)\s+(\S*)\s+([^\s,)]*)/]):o=this.matchRegex([/^(\S*)\s+([^\s,)]*)/]),!o)throw new Error("Expected coordinates");return p.hasZ&&p.hasM?new g(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]),parseFloat(o[4])):p.hasZ?new g(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3])):p.hasM?new g(parseFloat(o[1]),parseFloat(o[2]),void 0,parseFloat(o[3])):new g(parseFloat(o[1]),parseFloat(o[2]))},f.prototype.matchCoordinates=function(p){var o=[];do{var i=this.isMatch(["("]);o.push(this.matchCoordinate(p)),i&&this.expectGroupEnd()}while(this.isMatch([","]));return o},f.prototype.skipWhitespaces=function(){for(;this.position<this.value.length&&this.value[this.position]===" ";)this.position++},J}var z,Q;function W(){if(Q)return z;Q=1,z=y;var h=v,g=P(),f=C(),p=U(),o=j(),i=tt(),r=et(),t=rt(),e=it,n=Z,u=nt(),l=X;function y(){this.srid=void 0,this.hasZ=!1,this.hasM=!1}return y.parse=function(a,c){var s=typeof a;if(s==="string"||a instanceof u)return y._parseWkt(a);if(Buffer.isBuffer(a)||a instanceof e)return y._parseWkb(a,c);throw new Error("first argument must be a string or Buffer")},y._parseWkt=function(a){var c,s;a instanceof u?c=a:c=new u(a);var w=c.matchRegex([/^SRID=(\d+);/]);w&&(s=parseInt(w[1],10));var k=c.matchType(),d=c.matchDimension(),M={srid:s,hasZ:d.hasZ,hasM:d.hasM};switch(k){case h.wkt.Point:return g._parseWkt(c,M);case h.wkt.LineString:return f._parseWkt(c,M);case h.wkt.Polygon:return p._parseWkt(c,M);case h.wkt.MultiPoint:return o._parseWkt(c,M);case h.wkt.MultiLineString:return i._parseWkt(c,M);case h.wkt.MultiPolygon:return r._parseWkt(c,M);case h.wkt.GeometryCollection:return t._parseWkt(c,M)}},y._parseWkb=function(a,c){var s,w,k,d={};switch(a instanceof e?s=a:s=new e(a),s.isBigEndian=!s.readInt8(),w=s.readUInt32(),d.hasSrid=(w&536870912)===536870912,d.isEwkb=w&536870912||w&1073741824||w&2147483648,d.hasSrid&&(d.srid=s.readUInt32()),d.hasZ=!1,d.hasM=!1,!d.isEwkb&&(!c||!c.isEwkb)?w>=1e3&&w<2e3?(d.hasZ=!0,k=w-1e3):w>=2e3&&w<3e3?(d.hasM=!0,k=w-2e3):w>=3e3&&w<4e3?(d.hasZ=!0,d.hasM=!0,k=w-3e3):k=w:(w&2147483648&&(d.hasZ=!0),w&1073741824&&(d.hasM=!0),k=w&15),k){case h.wkb.Point:return g._parseWkb(s,d);case h.wkb.LineString:return f._parseWkb(s,d);case h.wkb.Polygon:return p._parseWkb(s,d);case h.wkb.MultiPoint:return o._parseWkb(s,d);case h.wkb.MultiLineString:return i._parseWkb(s,d);case h.wkb.MultiPolygon:return r._parseWkb(s,d);case h.wkb.GeometryCollection:return t._parseWkb(s,d);default:throw new Error("GeometryType "+k+" not supported")}},y.parseTwkb=function(a){var c,s={};a instanceof e?c=a:c=new e(a);var w=c.readUInt8(),k=c.readUInt8(),d=w&15;if(s.precision=l.decode(w>>4),s.precisionFactor=Math.pow(10,s.precision),s.hasBoundingBox=k>>0&1,s.hasSizeAttribute=k>>1&1,s.hasIdList=k>>2&1,s.hasExtendedPrecision=k>>3&1,s.isEmpty=k>>4&1,s.hasExtendedPrecision){var M=c.readUInt8();s.hasZ=(M&1)===1,s.hasM=(M&2)===2,s.zPrecision=l.decode((M&28)>>2),s.zPrecisionFactor=Math.pow(10,s.zPrecision),s.mPrecision=l.decode((M&224)>>5),s.mPrecisionFactor=Math.pow(10,s.mPrecision)}else s.hasZ=!1,s.hasM=!1;if(s.hasSizeAttribute&&c.readVarInt(),s.hasBoundingBox){var E=2;s.hasZ&&E++,s.hasM&&E++;for(var F=0;F<E;F++)c.readVarInt(),c.readVarInt()}switch(d){case h.wkb.Point:return g._parseTwkb(c,s);case h.wkb.LineString:return f._parseTwkb(c,s);case h.wkb.Polygon:return p._parseTwkb(c,s);case h.wkb.MultiPoint:return o._parseTwkb(c,s);case h.wkb.MultiLineString:return i._parseTwkb(c,s);case h.wkb.MultiPolygon:return r._parseTwkb(c,s);case h.wkb.GeometryCollection:return t._parseTwkb(c,s);default:throw new Error("GeometryType "+d+" not supported")}},y.parseGeoJSON=function(a){return y._parseGeoJSON(a)},y._parseGeoJSON=function(a,c){var s;switch(a.type){case h.geoJSON.Point:s=g._parseGeoJSON(a);break;case h.geoJSON.LineString:s=f._parseGeoJSON(a);break;case h.geoJSON.Polygon:s=p._parseGeoJSON(a);break;case h.geoJSON.MultiPoint:s=o._parseGeoJSON(a);break;case h.geoJSON.MultiLineString:s=i._parseGeoJSON(a);break;case h.geoJSON.MultiPolygon:s=r._parseGeoJSON(a);break;case h.geoJSON.GeometryCollection:s=t._parseGeoJSON(a);break;default:throw new Error("GeometryType "+a.type+" not supported")}if(a.crs&&a.crs.type&&a.crs.type==="name"&&a.crs.properties&&a.crs.properties.name){var w=a.crs.properties.name;if(w.indexOf("EPSG:")===0)s.srid=parseInt(w.substring(5));else if(w.indexOf("urn:ogc:def:crs:EPSG::")===0)s.srid=parseInt(w.substring(22));else throw new Error("Unsupported crs: "+w)}else c||(s.srid=4326);return s},y.prototype.toEwkt=function(){return"SRID="+this.srid+";"+this.toWkt()},y.prototype.toEwkb=function(){var a=new n(this._getWkbSize()+4),c=this.toWkb();return a.writeInt8(1),a.writeUInt32LE((c.slice(1,5).readUInt32LE(0)|536870912)>>>0,!0),a.writeUInt32LE(this.srid),a.writeBuffer(c.slice(5)),a.buffer},y.prototype._getWktType=function(a,c){var s=a;return this.hasZ&&this.hasM?s+=" ZM ":this.hasZ?s+=" Z ":this.hasM&&(s+=" M "),c&&!this.hasZ&&!this.hasM&&(s+=" "),c&&(s+="EMPTY"),s},y.prototype._getWktCoordinate=function(a){var c=a.x+" "+a.y;return this.hasZ&&(c+=" "+a.z),this.hasM&&(c+=" "+a.m),c},y.prototype._writeWkbType=function(a,c,s){var w=0;typeof this.srid>"u"&&(!s||typeof s.srid>"u")?this.hasZ&&this.hasM?w+=3e3:this.hasZ?w+=1e3:this.hasM&&(w+=2e3):(this.hasZ&&(w|=2147483648),this.hasM&&(w|=1073741824)),a.writeUInt32LE(w+c>>>0,!0)},y.getTwkbPrecision=function(a,c,s){return{xy:a,z:c,m:s,xyFactor:Math.pow(10,a),zFactor:Math.pow(10,c),mFactor:Math.pow(10,s)}},y.prototype._writeTwkbHeader=function(a,c,s,w){var k=(l.encode(s.xy)<<4)+c,d=(this.hasZ||this.hasM)<<3;if(d+=w<<4,a.writeUInt8(k),a.writeUInt8(d),this.hasZ||this.hasM){var M=0;this.hasZ&&(M|=1),this.hasM&&(M|=2),a.writeUInt8(M)}},y.prototype.toGeoJSON=function(a){var c={};return this.srid&&a&&(a.shortCrs?c.crs={type:"name",properties:{name:"EPSG:"+this.srid}}:a.longCrs&&(c.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+this.srid}})),c},z}_.Types=v;_.Geometry=W();_.Point=P();_.LineString=C();_.Polygon=U();_.MultiPoint=j();_.MultiLineString=tt();_.MultiPolygon=et();_.GeometryCollection=rt();export{_ as w};
